#include "out.h"



void * _base64_encode(long param_1,ulong param_2)

{
  uint uVar1;
  uint uVar2;
  size_t sVar3;
  void *pvVar4;
  uint uVar5;
  int local_30;
  int local_2c;
  
  sVar3 = ((param_2 + 2) / 3) * 4 + 1;
  pvVar4 = _malloc(sVar3);
  ___memset_chk(pvVar4,0,sVar3,0xffffffffffffffff);
  local_30 = 0;
  for (local_2c = 0; (ulong)(long)(local_2c + 3) <= param_2; local_2c = local_2c + 3) {
    uVar1 = (uint)*(byte *)(param_1 + local_2c) << 0x10;
    uVar2 = uVar1 | (uint)*(byte *)(param_1 + (local_2c + 1)) << 8;
    uVar5 = (uint)*(byte *)(param_1 + (local_2c + 2));
    *(char *)((long)pvVar4 + (long)local_30) =
         "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[uVar1 >> 0x12];
    *(char *)((long)pvVar4 + (long)(local_30 + 1)) =
         "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"
         [(uVar2 & 0x3f000) >> 0xc];
    *(char *)((long)pvVar4 + (long)(local_30 + 2)) =
         "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"
         [(uVar2 | uVar5) >> 6 & 0x3f];
    *(char *)((long)pvVar4 + (long)(local_30 + 3)) =
         "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[uVar5 & 0x3f];
    local_30 = local_30 + 4;
  }
  if (param_2 - (long)local_2c == 1) {
    uVar1 = (uint)*(byte *)(param_1 + local_2c) << 0x10;
    *(char *)((long)pvVar4 + (long)local_30) =
         "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[uVar1 >> 0x12];
    *(char *)((long)pvVar4 + (long)(local_30 + 1)) =
         "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[uVar1 >> 0xc & 0x3f];
    *(undefined1 *)((long)pvVar4 + (long)(local_30 + 2)) = 0x3d;
    *(undefined1 *)((long)pvVar4 + (long)(local_30 + 3)) = 0x3d;
    local_30 = local_30 + 4;
  }
  else if (param_2 - (long)local_2c == 2) {
    uVar1 = (uint)*(byte *)(param_1 + local_2c) << 0x10;
    uVar2 = (uint)*(byte *)(param_1 + (local_2c + 1)) << 8;
    *(char *)((long)pvVar4 + (long)local_30) =
         "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[uVar1 >> 0x12];
    *(char *)((long)pvVar4 + (long)(local_30 + 1)) =
         "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"
         [(uVar1 | uVar2) >> 0xc & 0x3f];
    *(char *)((long)pvVar4 + (long)(local_30 + 2)) =
         "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(uVar2 & 0xfc0) >> 6];
    *(undefined1 *)((long)pvVar4 + (long)(local_30 + 3)) = 0x3d;
    local_30 = local_30 + 4;
  }
  *(undefined1 *)((long)pvVar4 + (long)local_30) = 0;
  return pvVar4;
}



void _salsa20_permute(uint *param_1)

{
  int local_14;
  
  for (local_14 = 0; local_14 < 10; local_14 = local_14 + 1) {
    param_1[4] = ((*param_1 + param_1[0xc]) * 0x80 | *param_1 + param_1[0xc] >> 0x19) ^ param_1[4];
    param_1[8] = ((param_1[4] + *param_1) * 0x200 | param_1[4] + *param_1 >> 0x17) ^ param_1[8];
    param_1[0xc] = ((param_1[8] + param_1[4]) * 0x2000 | param_1[8] + param_1[4] >> 0x13) ^
                   param_1[0xc];
    *param_1 = ((param_1[0xc] + param_1[8]) * 0x40000 | param_1[0xc] + param_1[8] >> 0xe) ^ *param_1
    ;
    param_1[9] = ((param_1[5] + param_1[1]) * 0x80 | param_1[5] + param_1[1] >> 0x19) ^ param_1[9];
    param_1[0xd] = ((param_1[9] + param_1[5]) * 0x200 | param_1[9] + param_1[5] >> 0x17) ^
                   param_1[0xd];
    param_1[1] = ((param_1[0xd] + param_1[9]) * 0x2000 | param_1[0xd] + param_1[9] >> 0x13) ^
                 param_1[1];
    param_1[5] = ((param_1[1] + param_1[0xd]) * 0x40000 | param_1[1] + param_1[0xd] >> 0xe) ^
                 param_1[5];
    param_1[0xe] = ((param_1[10] + param_1[6]) * 0x80 | param_1[10] + param_1[6] >> 0x19) ^
                   param_1[0xe];
    param_1[2] = ((param_1[0xe] + param_1[10]) * 0x200 | param_1[0xe] + param_1[10] >> 0x17) ^
                 param_1[2];
    param_1[6] = ((param_1[2] + param_1[0xe]) * 0x2000 | param_1[2] + param_1[0xe] >> 0x13) ^
                 param_1[6];
    param_1[10] = ((param_1[6] + param_1[2]) * 0x40000 | param_1[6] + param_1[2] >> 0xe) ^
                  param_1[10];
    param_1[3] = ((param_1[0xf] + param_1[0xb]) * 0x80 | param_1[0xf] + param_1[0xb] >> 0x19) ^
                 param_1[3];
    param_1[7] = ((param_1[3] + param_1[0xf]) * 0x200 | param_1[3] + param_1[0xf] >> 0x17) ^
                 param_1[7];
    param_1[0xb] = ((param_1[7] + param_1[3]) * 0x2000 | param_1[7] + param_1[3] >> 0x13) ^
                   param_1[0xb];
    param_1[0xf] = ((param_1[0xb] + param_1[7]) * 0x40000 | param_1[0xb] + param_1[7] >> 0xe) ^
                   param_1[0xf];
    param_1[1] = ((*param_1 + param_1[3]) * 0x80 | *param_1 + param_1[3] >> 0x19) ^ param_1[1];
    param_1[2] = ((param_1[1] + *param_1) * 0x200 | param_1[1] + *param_1 >> 0x17) ^ param_1[2];
    param_1[3] = ((param_1[2] + param_1[1]) * 0x2000 | param_1[2] + param_1[1] >> 0x13) ^ param_1[3]
    ;
    *param_1 = ((param_1[3] + param_1[2]) * 0x40000 | param_1[3] + param_1[2] >> 0xe) ^ *param_1;
    param_1[6] = ((param_1[5] + param_1[4]) * 0x80 | param_1[5] + param_1[4] >> 0x19) ^ param_1[6];
    param_1[7] = ((param_1[6] + param_1[5]) * 0x200 | param_1[6] + param_1[5] >> 0x17) ^ param_1[7];
    param_1[4] = ((param_1[7] + param_1[6]) * 0x2000 | param_1[7] + param_1[6] >> 0x13) ^ param_1[4]
    ;
    param_1[5] = ((param_1[4] + param_1[7]) * 0x40000 | param_1[4] + param_1[7] >> 0xe) ^ param_1[5]
    ;
    param_1[0xb] = ((param_1[10] + param_1[9]) * 0x80 | param_1[10] + param_1[9] >> 0x19) ^
                   param_1[0xb];
    param_1[8] = ((param_1[0xb] + param_1[10]) * 0x200 | param_1[0xb] + param_1[10] >> 0x17) ^
                 param_1[8];
    param_1[9] = ((param_1[8] + param_1[0xb]) * 0x2000 | param_1[8] + param_1[0xb] >> 0x13) ^
                 param_1[9];
    param_1[10] = ((param_1[9] + param_1[8]) * 0x40000 | param_1[9] + param_1[8] >> 0xe) ^
                  param_1[10];
    param_1[0xc] = ((param_1[0xf] + param_1[0xe]) * 0x80 | param_1[0xf] + param_1[0xe] >> 0x19) ^
                   param_1[0xc];
    param_1[0xd] = ((param_1[0xc] + param_1[0xf]) * 0x200 | param_1[0xc] + param_1[0xf] >> 0x17) ^
                   param_1[0xd];
    param_1[0xe] = ((param_1[0xd] + param_1[0xc]) * 0x2000 | param_1[0xd] + param_1[0xc] >> 0x13) ^
                   param_1[0xe];
    param_1[0xf] = ((param_1[0xe] + param_1[0xd]) * 0x40000 | param_1[0xe] + param_1[0xd] >> 0xe) ^
                   param_1[0xf];
  }
  return;
}



void _salsa20_block(undefined4 *param_1,undefined4 *param_2,undefined8 param_3,long param_4)

{
  int iVar1;
  int local_c4;
  int local_c0;
  int local_bc;
  int aiStack_98 [16];
  int local_58 [18];
  long local_10;
  
  local_10 = *(long *)PTR____stack_chk_guard_100002010;
  local_58[0] = 0x61707865;
  local_58[1] = *param_1;
  local_58[2] = param_1[1];
  local_58[3] = param_1[2];
  local_58[4] = param_1[3];
  local_58[5] = 0x3320646e;
  local_58[6] = *param_2;
  local_58[7] = param_2[1];
  local_58[8] = (int)param_3;
  local_58[9] = (int)((ulong)param_3 >> 0x20);
  local_58[10] = 0x79622d32;
  local_58[0xb] = param_1[4];
  local_58[0xc] = param_1[5];
  local_58[0xd] = param_1[6];
  local_58[0xe] = param_1[7];
  local_58[0xf] = 0x6b206574;
  for (local_bc = 0; local_bc < 0x10; local_bc = local_bc + 1) {
    aiStack_98[local_bc] = local_58[local_bc];
  }
  _salsa20_permute(local_58);
  for (local_c0 = 0; local_c0 < 0x10; local_c0 = local_c0 + 1) {
    local_58[local_c0] = local_58[local_c0] + aiStack_98[local_c0];
  }
  for (local_c4 = 0; local_c4 < 0x10; local_c4 = local_c4 + 1) {
    iVar1 = local_58[local_c4];
    *(char *)(param_4 + (local_c4 << 2)) = (char)iVar1;
    *(char *)(param_4 + (local_c4 * 4 + 1)) = (char)((uint)iVar1 >> 8);
    *(char *)(param_4 + (local_c4 * 4 + 2)) = (char)((uint)iVar1 >> 0x10);
    *(char *)(param_4 + (local_c4 * 4 + 3)) = (char)((uint)iVar1 >> 0x18);
  }
  if (*(long *)PTR____stack_chk_guard_100002010 == local_10) {
    return;
  }
                    // WARNING: Subroutine does not return
  ___stack_chk_fail();
}



undefined4 entry(int param_1,long param_2)

{
  char *pcVar1;
  int iVar2;
  size_t sVar3;
  void *pvVar4;
  uint local_278;
  undefined4 local_25c;
  byte local_258 [64];
  byte local_218 [520];
  long local_10;
  
  local_10 = *(long *)PTR____stack_chk_guard_100002010;
  if (param_1 < 3) {
    _printf("Encryption \n\n");
    _printf("Usage:\n");
    _printf("  soso -e \"plaintext\"        Encrypt plaintext\n");
    _printf("  soso -h                    Show help\n\n");
    local_25c = 1;
  }
  else {
    iVar2 = _strcmp(*(char **)(param_2 + 8),"-e");
    if (iVar2 == 0) {
      pcVar1 = *(char **)(param_2 + 0x10);
      sVar3 = _strlen(pcVar1);
      _salsa20_block(&_KEY,&_NONCE,0,local_258);
      for (local_278 = 0; local_278 < (uint)sVar3; local_278 = local_278 + 1) {
        local_218[local_278] = pcVar1[local_278] ^ local_258[local_278];
      }
      pvVar4 = (void *)_base64_encode(local_218,(uint)sVar3);
      _printf("%s\n",pvVar4);
      _free(pvVar4);
    }
    else {
      iVar2 = _strcmp(*(char **)(param_2 + 8),"-h");
      if (iVar2 != 0) {
        iVar2 = _strcmp(*(char **)(param_2 + 8),"--help");
        if (iVar2 != 0) {
          _printf("Unknown option: %s\n",*(undefined8 *)(param_2 + 8));
          local_25c = 1;
          goto LAB_1000015b7;
        }
      }
      _printf("Encryption Tool\n\n");
      _printf("This tool encrypts messages in a way that\'s compatible\n");
      _printf("Commands:\n");
      _printf("  -e <text>     Encrypt plaintext\n");
      _printf("  -h            Show this help\n\n");
      _printf("Example:\n");
      _printf("  ./soso -e \"test message\"\n");
      _printf("  Output: ss1Dj5y220SyBP35\n\n");
    }
    local_25c = 0;
  }
LAB_1000015b7:
  if (*(long *)PTR____stack_chk_guard_100002010 == local_10) {
    return local_25c;
  }
                    // WARNING: Subroutine does not return
  ___stack_chk_fail();
}



void ___memset_chk(void)

{
                    // WARNING: Could not recover jumptable at 0x0001000015ea. Too many branches
                    // WARNING: Treating indirect jump as call
  (*(code *)PTR____memset_chk_100002000)();
  return;
}



void ___stack_chk_fail(void)

{
                    // WARNING: Could not recover jumptable at 0x0001000015f0. Too many branches
                    // WARNING: Treating indirect jump as call
  (*(code *)PTR____stack_chk_fail_100002008)();
  return;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

void _free(void *param_1)

{
                    // WARNING: Could not recover jumptable at 0x0001000015f6. Too many branches
                    // WARNING: Treating indirect jump as call
  (*(code *)PTR__free_100002018)();
  return;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

void * _malloc(size_t param_1)

{
  void *pvVar1;
  
                    // WARNING: Could not recover jumptable at 0x0001000015fc. Too many branches
                    // WARNING: Treating indirect jump as call
  pvVar1 = (void *)(*(code *)PTR__malloc_100002020)();
  return pvVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int _printf(char *param_1,...)

{
  int iVar1;
  
                    // WARNING: Could not recover jumptable at 0x000100001602. Too many branches
                    // WARNING: Treating indirect jump as call
  iVar1 = (*(code *)PTR__printf_100002028)();
  return iVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int _strcmp(char *param_1,char *param_2)

{
  int iVar1;
  
                    // WARNING: Could not recover jumptable at 0x000100001608. Too many branches
                    // WARNING: Treating indirect jump as call
  iVar1 = (*(code *)PTR__strcmp_100002030)();
  return iVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

size_t _strlen(char *param_1)

{
  size_t sVar1;
  
                    // WARNING: Could not recover jumptable at 0x00010000160e. Too many branches
                    // WARNING: Treating indirect jump as call
  sVar1 = (*(code *)PTR__strlen_100002038)();
  return sVar1;
}



